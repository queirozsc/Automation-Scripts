drop view TASY.UNIMED_INDICADOR_OS_TI_V2;

create or replace view TASY.UNIMED_INDICADOR_OS_TI_V2
as
select
    'abertas' ds_informacao,
    trunc(DT_ORDEM_SERVICO,'MM') dt_parametro,
	DS_DIA_EXEC, 
	DS_DIA_ATRASO, 
	DS_DIA_SEMANA, 
	IE_PRIORIDADE, 
	DS_PRIORIDADE, 
	IE_PARADO, 
	DS_PARADO, 
	NR_SEQ_LOCALIZACAO, 
	DS_LOCALIZACAO, 
	DS_CLASSIFICACAO, 
	NR_SEQ_CLASSIF, 
	DS_SUB_CLASSIFICACAO,  
	CD_PESSOA_SOLICITANTE, 
	CD_PESSOA_FISICA, 
	NM_SOLICITANTE, 
	NR_SEQ_EQUIPAMENTO, 
	DS_EQUIPAMENTO, 
	CD_SETOR_ATENDIMENTO, 
	CD_CENTRO_CUSTO, 
	DS_CENTRO_CUSTO, 
	CD_CENTRO_CUSTO_LOCALIZ, 
	DS_CENTRO_CUSTO_LOCALIZ, 
	CD_CENTRO_CUS_SOLIC, 
	DS_CENTRO_CUS_SOLIC, 
	DS_SETOR_ATENDIMENTO, 
	CD_ESTABELECIMENTO, 
	DS_ESTAB_LOCALIZ, 
	NR_GRUPO_TRABALHO, 
	DS_GRUPO_TRABALHO, 
	IE_STATUS_ORDEM, 
	DS_STATUS_ORDEM, 
	CD_ESTAGIO, 
	DS_ESTAGIO, 
	DS_USUARIO_EXEC, 
	DS_COMPLEXIDADE, 
	IE_CLASSIFICACAO, 
	DS_GRAU_SATISFACAO, 
	CD_FUNCAO, 
	DS_FUNCAO, 
	NR_GRUPO_PLANEJ, 
	DS_GRUPO_PLANEJAMENTO,
	DS_CATEGORIA_GRUPO, 
	
	
	
	sum(QT_TOTAL) qt_abertas,
	(sum(QT_TOTAL)-sum(QT_ENCERRADA)) qt_pendentes,
	
	0 qt_encerradas,
	0 qt_encerradas_backlog,
	0 QT_ENCERRADAS_TOTAL,
	
	sum(QT_MIN_PRIM_ATEND) QT_MIN_PRIM_ATEND, 
	sum(QT_HORAS_PRIM_ATEND) QT_HORAS_PRIM_ATEND, 
	sum(QT_MIN_ATIV_OS) QT_MIN_ATIV_OS, 
	sum(QT_HORAS_ATIV_OS) QT_HORAS_ATIV_OS,
	sum(QT_ENCERRADA) qt_encerradas_periodo
	
	
	
	
	
	
from UNIMED_INDICADOR_OS_TI

--where trunc(DT_ORDEM_SERVICO,'MM')=to_date('01/09/2015','dd/mm/yyyy')


group by 	
			trunc(DT_ORDEM_SERVICO,'MM'),
			DS_DIA_EXEC, 
			DS_DIA_ATRASO, 
			DS_DIA_SEMANA, 
			IE_PRIORIDADE, 
			DS_PRIORIDADE, 
			IE_PARADO, 
			DS_PARADO, 
			NR_SEQ_LOCALIZACAO, 
			DS_LOCALIZACAO, 
			DS_CLASSIFICACAO, 
			NR_SEQ_CLASSIF, 
			DS_SUB_CLASSIFICACAO, 
			CD_PESSOA_SOLICITANTE, 
			CD_PESSOA_FISICA, 
			NM_SOLICITANTE, 
			NR_SEQ_EQUIPAMENTO, 
			DS_EQUIPAMENTO, 
			CD_SETOR_ATENDIMENTO, 
			CD_CENTRO_CUSTO, 
			DS_CENTRO_CUSTO, 
			CD_CENTRO_CUSTO_LOCALIZ, 
			DS_CENTRO_CUSTO_LOCALIZ, 
			CD_CENTRO_CUS_SOLIC, 
			DS_CENTRO_CUS_SOLIC, 
			DS_SETOR_ATENDIMENTO, 
			CD_ESTABELECIMENTO, 
			DS_ESTAB_LOCALIZ, 
			NR_GRUPO_TRABALHO, 
			DS_GRUPO_TRABALHO, 
			IE_STATUS_ORDEM, 
			DS_STATUS_ORDEM, 
			CD_ESTAGIO, 
			DS_ESTAGIO, 
			DS_USUARIO_EXEC, 
			DS_COMPLEXIDADE, 
			IE_CLASSIFICACAO, 
			DS_GRAU_SATISFACAO, 
			CD_FUNCAO, 
			DS_FUNCAO, 
			NR_GRUPO_PLANEJ, 
			DS_GRUPO_PLANEJAMENTO,
			DS_CATEGORIA_GRUPO 
			

union


select
    'encerradas' ds_informacao,
    trunc(DT_FIM_REAL,'MM') dt_parametro,
	DS_DIA_EXEC, 
	DS_DIA_ATRASO, 
	DS_DIA_SEMANA, 
	IE_PRIORIDADE, 
	DS_PRIORIDADE, 
	IE_PARADO, 
	DS_PARADO, 
	NR_SEQ_LOCALIZACAO, 
	DS_LOCALIZACAO, 
	DS_CLASSIFICACAO, 
	NR_SEQ_CLASSIF, 
	DS_SUB_CLASSIFICACAO, 
	CD_PESSOA_SOLICITANTE, 
	CD_PESSOA_FISICA, 
	NM_SOLICITANTE, 
	NR_SEQ_EQUIPAMENTO, 
	DS_EQUIPAMENTO, 
	CD_SETOR_ATENDIMENTO, 
	CD_CENTRO_CUSTO, 
	DS_CENTRO_CUSTO, 
	CD_CENTRO_CUSTO_LOCALIZ, 
	DS_CENTRO_CUSTO_LOCALIZ, 
	CD_CENTRO_CUS_SOLIC, 
	DS_CENTRO_CUS_SOLIC, 
	DS_SETOR_ATENDIMENTO, 
	CD_ESTABELECIMENTO, 
	DS_ESTAB_LOCALIZ, 
	NR_GRUPO_TRABALHO, 
	DS_GRUPO_TRABALHO, 
	IE_STATUS_ORDEM, 
	DS_STATUS_ORDEM, 
	CD_ESTAGIO, 
	DS_ESTAGIO, 
	DS_USUARIO_EXEC, 
	DS_COMPLEXIDADE, 
	IE_CLASSIFICACAO, 
	DS_GRAU_SATISFACAO, 
	CD_FUNCAO, 
	DS_FUNCAO, 
	NR_GRUPO_PLANEJ, 
	DS_GRUPO_PLANEJAMENTO,
	DS_CATEGORIA_GRUPO, 
	
	0 qt_abertas,
	0 qt_pendentes,
	sum(QT_TOTAL) qt_encerradas,
	SUM(ie_comp_anterior_enc) qt_encerradas_backlog,
	(sum(QT_TOTAL)+SUM(IE_COMP_ANTERIOR)) QT_ENCERRADAS_TOTAL,
	
	sum(QT_MIN_PRIM_ATEND) QT_MIN_PRIM_ATEND, 
	sum(QT_HORAS_PRIM_ATEND) QT_HORAS_PRIM_ATEND, 
	sum(QT_MIN_ATIV_OS) QT_MIN_ATIV_OS, 
	sum(QT_HORAS_ATIV_OS) QT_HORAS_ATIV_OS,
	
	0 qt_encerradas_periodo

	
from UNIMED_INDICADOR_OS_TI

--where trunc(DT_FIM_REAL,'MM') = to_date('01/09/2015','dd/mm/yyyy')


group by
			trunc(DT_FIM_REAL,'MM'),
		 	DS_DIA_EXEC, 
			DS_DIA_ATRASO, 
			DS_DIA_SEMANA, 
			IE_PRIORIDADE, 
			DS_PRIORIDADE, 
			IE_PARADO, 
			DS_PARADO, 
			NR_SEQ_LOCALIZACAO, 
			DS_LOCALIZACAO, 
			DS_CLASSIFICACAO, 
			NR_SEQ_CLASSIF, 
			DS_SUB_CLASSIFICACAO, 
			CD_PESSOA_SOLICITANTE, 
			CD_PESSOA_FISICA, 
			NM_SOLICITANTE, 
			NR_SEQ_EQUIPAMENTO, 
			DS_EQUIPAMENTO, 
			CD_SETOR_ATENDIMENTO, 
			CD_CENTRO_CUSTO, 
			DS_CENTRO_CUSTO, 
			CD_CENTRO_CUSTO_LOCALIZ, 
			DS_CENTRO_CUSTO_LOCALIZ, 
			CD_CENTRO_CUS_SOLIC, 
			DS_CENTRO_CUS_SOLIC, 
			DS_SETOR_ATENDIMENTO, 
			CD_ESTABELECIMENTO, 
			DS_ESTAB_LOCALIZ, 
			NR_GRUPO_TRABALHO, 
			DS_GRUPO_TRABALHO, 
			IE_STATUS_ORDEM, 
			DS_STATUS_ORDEM, 
			CD_ESTAGIO, 
			DS_ESTAGIO, 
			DS_USUARIO_EXEC, 
			DS_COMPLEXIDADE, 
			IE_CLASSIFICACAO, 
			DS_GRAU_SATISFACAO, 
			CD_FUNCAO, 
			DS_FUNCAO, 
			NR_GRUPO_PLANEJ, 
			DS_GRUPO_PLANEJAMENTO,
			DS_CATEGORIA_GRUPO;

