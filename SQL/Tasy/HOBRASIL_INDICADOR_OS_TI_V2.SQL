DROP VIEW TASY.HOBRASIL_INDICADOR_OS_TI_V2;

CREATE 
OR REPLACE VIEW TASY.HOBRASIL_INDICADOR_OS_TI_V2 AS 
SELECT
    'ABERTAS' DS_INFORMACAO,
    TRUNC(DT_ORDEM_SERVICO, 'MM') DT_PARAMETRO,
    DS_DIA_EXEC,
    DS_DIA_ATRASO,
    DS_DIA_SEMANA,
    IE_PRIORIDADE,
    DS_PRIORIDADE,
    IE_PARADO,
    DS_PARADO,
    NR_SEQ_LOCALIZACAO,
    DS_LOCALIZACAO,
    DS_CLASSIFICACAO,
    NR_SEQ_CLASSIF,
    DS_SUB_CLASSIFICACAO,
    CD_PESSOA_SOLICITANTE,
    CD_PESSOA_FISICA,
    NM_SOLICITANTE,
    NR_SEQ_EQUIPAMENTO,
    DS_EQUIPAMENTO,
    CD_SETOR_ATENDIMENTO,
    CD_CENTRO_CUSTO,
    DS_CENTRO_CUSTO,
    CD_CENTRO_CUSTO_LOCALIZ,
    DS_CENTRO_CUSTO_LOCALIZ,
    CD_CENTRO_CUS_SOLIC,
    DS_CENTRO_CUS_SOLIC,
    DS_SETOR_ATENDIMENTO,
    CD_ESTABELECIMENTO,
    DS_ESTAB_LOCALIZ,
    NR_GRUPO_TRABALHO,
    DS_GRUPO_TRABALHO,
    IE_STATUS_ORDEM,
    DS_STATUS_ORDEM,
    CD_ESTAGIO,
    DS_ESTAGIO,
    DS_USUARIO_EXEC,
    DS_COMPLEXIDADE,
    IE_CLASSIFICACAO,
    DS_GRAU_SATISFACAO,
    CD_FUNCAO,
    DS_FUNCAO,
    NR_GRUPO_PLANEJ,
    DS_GRUPO_PLANEJAMENTO,
    DS_CATEGORIA_GRUPO,
    SUM(QT_TOTAL) QT_ABERTAS,
    (SUM(QT_TOTAL) - SUM(QT_ENCERRADA)) QT_PENDENTES,
    0 QT_ENCERRADAS,
    0 QT_ENCERRADAS_BACKLOG,
    0 QT_ENCERRADAS_TOTAL,
    SUM(QT_MIN_PRIM_ATEND) QT_MIN_PRIM_ATEND,
    SUM(QT_HORAS_PRIM_ATEND) QT_HORAS_PRIM_ATEND,
    SUM(QT_MIN_ATIV_OS) QT_MIN_ATIV_OS,
    SUM(QT_HORAS_ATIV_OS) QT_HORAS_ATIV_OS,
    SUM(QT_ENCERRADA) QT_ENCERRADAS_PERIODO 
FROM
    HOBRASIL_INDICADOR_OS_TI 	--where trunc(DT_ORDEM_SERVICO,'MM')=to_date('01/09/2015','dd/mm/yyyy')
GROUP BY
    TRUNC(DT_ORDEM_SERVICO, 'MM'),
    DS_DIA_EXEC,
    DS_DIA_ATRASO,
    DS_DIA_SEMANA,
    IE_PRIORIDADE,
    DS_PRIORIDADE,
    IE_PARADO,
    DS_PARADO,
    NR_SEQ_LOCALIZACAO,
    DS_LOCALIZACAO,
    DS_CLASSIFICACAO,
    NR_SEQ_CLASSIF,
    DS_SUB_CLASSIFICACAO,
    CD_PESSOA_SOLICITANTE,
    CD_PESSOA_FISICA,
    NM_SOLICITANTE,
    NR_SEQ_EQUIPAMENTO,
    DS_EQUIPAMENTO,
    CD_SETOR_ATENDIMENTO,
    CD_CENTRO_CUSTO,
    DS_CENTRO_CUSTO,
    CD_CENTRO_CUSTO_LOCALIZ,
    DS_CENTRO_CUSTO_LOCALIZ,
    CD_CENTRO_CUS_SOLIC,
    DS_CENTRO_CUS_SOLIC,
    DS_SETOR_ATENDIMENTO,
    CD_ESTABELECIMENTO,
    DS_ESTAB_LOCALIZ,
    NR_GRUPO_TRABALHO,
    DS_GRUPO_TRABALHO,
    IE_STATUS_ORDEM,
    DS_STATUS_ORDEM,
    CD_ESTAGIO,
    DS_ESTAGIO,
    DS_USUARIO_EXEC,
    DS_COMPLEXIDADE,
    IE_CLASSIFICACAO,
    DS_GRAU_SATISFACAO,
    CD_FUNCAO,
    DS_FUNCAO,
    NR_GRUPO_PLANEJ,
    DS_GRUPO_PLANEJAMENTO,
    DS_CATEGORIA_GRUPO 
UNION
SELECT
    'ENCERRADAS' DS_INFORMACAO,
    TRUNC(DT_FIM_REAL, 'MM') DT_PARAMETRO,
    DS_DIA_EXEC,
    DS_DIA_ATRASO,
    DS_DIA_SEMANA,
    IE_PRIORIDADE,
    DS_PRIORIDADE,
    IE_PARADO,
    DS_PARADO,
    NR_SEQ_LOCALIZACAO,
    DS_LOCALIZACAO,
    DS_CLASSIFICACAO,
    NR_SEQ_CLASSIF,
    DS_SUB_CLASSIFICACAO,
    CD_PESSOA_SOLICITANTE,
    CD_PESSOA_FISICA,
    NM_SOLICITANTE,
    NR_SEQ_EQUIPAMENTO,
    DS_EQUIPAMENTO,
    CD_SETOR_ATENDIMENTO,
    CD_CENTRO_CUSTO,
    DS_CENTRO_CUSTO,
    CD_CENTRO_CUSTO_LOCALIZ,
    DS_CENTRO_CUSTO_LOCALIZ,
    CD_CENTRO_CUS_SOLIC,
    DS_CENTRO_CUS_SOLIC,
    DS_SETOR_ATENDIMENTO,
    CD_ESTABELECIMENTO,
    DS_ESTAB_LOCALIZ,
    NR_GRUPO_TRABALHO,
    DS_GRUPO_TRABALHO,
    IE_STATUS_ORDEM,
    DS_STATUS_ORDEM,
    CD_ESTAGIO,
    DS_ESTAGIO,
    DS_USUARIO_EXEC,
    DS_COMPLEXIDADE,
    IE_CLASSIFICACAO,
    DS_GRAU_SATISFACAO,
    CD_FUNCAO,
    DS_FUNCAO,
    NR_GRUPO_PLANEJ,
    DS_GRUPO_PLANEJAMENTO,
    DS_CATEGORIA_GRUPO,
    0 QT_ABERTAS,
    0 QT_PENDENTES,
    SUM(QT_TOTAL) QT_ENCERRADAS,
    SUM(IE_COMP_ANTERIOR_ENC) QT_ENCERRADAS_BACKLOG,
    (SUM(QT_TOTAL) + SUM(IE_COMP_ANTERIOR)) QT_ENCERRADAS_TOTAL,
    SUM(QT_MIN_PRIM_ATEND) QT_MIN_PRIM_ATEND,
    SUM(QT_HORAS_PRIM_ATEND) QT_HORAS_PRIM_ATEND,
    SUM(QT_MIN_ATIV_OS) QT_MIN_ATIV_OS,
    SUM(QT_HORAS_ATIV_OS) QT_HORAS_ATIV_OS,
    0 QT_ENCERRADAS_PERIODO 
FROM
    HOBRASIL_INDICADOR_OS_TI 	--where trunc(DT_FIM_REAL,'MM') = to_date('01/09/2015','dd/mm/yyyy')
GROUP BY
    TRUNC(DT_FIM_REAL, 'MM'),
    DS_DIA_EXEC,
    DS_DIA_ATRASO,
    DS_DIA_SEMANA,
    IE_PRIORIDADE,
    DS_PRIORIDADE,
    IE_PARADO,
    DS_PARADO,
    NR_SEQ_LOCALIZACAO,
    DS_LOCALIZACAO,
    DS_CLASSIFICACAO,
    NR_SEQ_CLASSIF,
    DS_SUB_CLASSIFICACAO,
    CD_PESSOA_SOLICITANTE,
    CD_PESSOA_FISICA,
    NM_SOLICITANTE,
    NR_SEQ_EQUIPAMENTO,
    DS_EQUIPAMENTO,
    CD_SETOR_ATENDIMENTO,
    CD_CENTRO_CUSTO,
    DS_CENTRO_CUSTO,
    CD_CENTRO_CUSTO_LOCALIZ,
    DS_CENTRO_CUSTO_LOCALIZ,
    CD_CENTRO_CUS_SOLIC,
    DS_CENTRO_CUS_SOLIC,
    DS_SETOR_ATENDIMENTO,
    CD_ESTABELECIMENTO,
    DS_ESTAB_LOCALIZ,
    NR_GRUPO_TRABALHO,
    DS_GRUPO_TRABALHO,
    IE_STATUS_ORDEM,
    DS_STATUS_ORDEM,
    CD_ESTAGIO,
    DS_ESTAGIO,
    DS_USUARIO_EXEC,
    DS_COMPLEXIDADE,
    IE_CLASSIFICACAO,
    DS_GRAU_SATISFACAO,
    CD_FUNCAO,
    DS_FUNCAO,
    NR_GRUPO_PLANEJ,
    DS_GRUPO_PLANEJAMENTO,
    DS_CATEGORIA_GRUPO;

SELECT * TASY.HOBRASIL_INDICADOR_OS_TI_V2